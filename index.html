<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanopify - Music for Everyone</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Tailwind Config for Custom Colors & Fonts -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        glass: {
                            light: 'rgba(255, 255, 255, 0.25)',
                            dark: 'rgba(15, 23, 42, 0.4)',
                            border: 'rgba(255, 255, 255, 0.1)',
                        },
                        accent: '#8b5cf6', // Violet
                    },
                    animation: {
                        'blob': 'blob 7s infinite',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #8b5cf6;
            border-radius: 10px;
        }
        
        /* Glassmorphism Utilities */
        .glass-panel {
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        /* Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 12px;
            width: 12px;
            border-radius: 50%;
            background: #fff;
            margin-top: -4px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-slate-900 text-slate-800 dark:text-white transition-colors duration-300 min-h-screen flex flex-col overflow-x-hidden">

    <!-- Background Animated Blobs -->
    <div class="fixed inset-0 w-full h-full pointer-events-none z-0 overflow-hidden">
        <div class="absolute top-0 left-1/4 w-96 h-96 bg-purple-400 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob"></div>
        <div class="absolute top-0 right-1/4 w-96 h-96 bg-blue-400 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000"></div>
        <div class="absolute -bottom-32 left-1/3 w-96 h-96 bg-pink-400 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-4000"></div>
    </div>

    <!-- Navbar -->
    <nav class="fixed top-0 w-full z-50 px-6 py-4 glass-panel bg-white/30 dark:bg-slate-900/50 border-b border-white/10">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <i class="fa-brands fa-spotify text-3xl text-purple-600 dark:text-purple-400"></i>
                <span class="text-2xl font-bold tracking-tight">Sanopify</span>
            </div>
            
            <button id="theme-toggle" class="p-2 rounded-full hover:bg-white/20 transition-colors">
                <i class="fas fa-moon text-xl dark:hidden"></i>
                <i class="fas fa-sun text-xl hidden dark:block text-yellow-300"></i>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="relative z-10 flex-grow pt-28 pb-32 px-4 sm:px-6">
        <div class="max-w-7xl mx-auto">
            
            <!-- Hero Search Section -->
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-6xl font-bold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-purple-600 to-blue-500 dark:from-purple-400 dark:to-blue-400">
                    Temukan Iramamu
                </h1>
                
                <div class="max-w-2xl mx-auto relative group">
                    <div class="absolute -inset-1 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full blur opacity-25 group-hover:opacity-50 transition duration-1000 group-hover:duration-200"></div>
                    <div class="relative flex items-center">
                        <input type="text" id="search-input" 
                            placeholder="Cari lagu, artis, atau album..." 
                            class="w-full py-4 pl-6 pr-14 rounded-full bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border border-gray-200 dark:border-slate-700 focus:outline-none focus:ring-2 focus:ring-purple-500 shadow-xl text-lg placeholder-gray-400 dark:placeholder-slate-500 text-gray-800 dark:text-white transition-all"
                            autocomplete="off">
                        <button id="search-btn" class="absolute right-2 p-2.5 bg-purple-600 hover:bg-purple-700 text-white rounded-full transition-colors shadow-lg">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                <p class="mt-4 text-sm text-gray-500 dark:text-slate-400">Powered by iTunes API (Preview Only)</p>
            </div>

            <!-- Loading State -->
            <div id="loader" class="hidden flex justify-center py-12">
                <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"></div>
            </div>

            <!-- Error State -->
            <div id="error-msg" class="hidden text-center py-8 text-red-500 font-semibold">
                Terjadi kesalahan atau lagu tidak ditemukan.
            </div>

            <!-- Results Grid -->
            <div id="results-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                <!-- Cards will be injected here via JS -->
            </div>
            
            <!-- Empty State -->
            <div id="empty-state" class="text-center py-20 opacity-60">
                <i class="fas fa-music text-6xl mb-4 text-gray-300 dark:text-slate-700"></i>
                <p class="text-xl">Mulai cari musik favoritmu sekarang.</p>
            </div>
        </div>
    </main>

    <!-- Player Bar (Fixed Bottom) -->
    <div id="player-bar" class="fixed bottom-0 w-full z-50 glass-panel bg-white/80 dark:bg-slate-900/90 border-t border-white/10 backdrop-blur-xl transform translate-y-full transition-transform duration-500">
        
        <!-- Progress Bar (Top of player) -->
        <div class="w-full h-1 bg-gray-200 dark:bg-slate-700 cursor-pointer group" id="progress-container">
            <div id="progress-bar" class="h-full bg-purple-600 relative w-0 transition-all duration-100 ease-linear">
                <div class="absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full shadow opacity-0 group-hover:opacity-100 transition-opacity"></div>
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between gap-4">
            
            <!-- Song Info -->
            <div class="flex items-center gap-4 w-1/3 min-w-[120px]">
                <img id="player-img" src="https://via.placeholder.com/100" alt="Album Art" class="w-12 h-12 rounded-md shadow-md object-cover">
                <div class="overflow-hidden">
                    <h3 id="player-title" class="text-sm font-bold truncate text-slate-800 dark:text-white">Pilih Lagu</h3>
                    <p id="player-artist" class="text-xs text-gray-500 dark:text-slate-400 truncate">Sanopify</p>
                </div>
            </div>

            <!-- Controls -->
            <div class="flex flex-col items-center justify-center w-1/3">
                <div class="flex items-center gap-6">
                    <button class="text-gray-400 hover:text-gray-600 dark:hover:text-white transition"><i class="fas fa-backward-step"></i></button>
                    
                    <button id="main-play-btn" class="w-10 h-10 flex items-center justify-center rounded-full bg-white text-black shadow-lg hover:scale-105 transition transform">
                        <i class="fas fa-play ml-0.5 text-sm"></i>
                    </button>
                    
                    <button class="text-gray-400 hover:text-gray-600 dark:hover:text-white transition"><i class="fas fa-forward-step"></i></button>
                </div>
            </div>

            <!-- Volume / Extra -->
            <div class="flex items-center justify-end gap-3 w-1/3 min-w-[100px]">
                <i class="fas fa-volume-up text-xs text-gray-500"></i>
                <input type="range" min="0" max="1" step="0.1" value="1" id="volume-slider" class="w-20 md:w-24">
            </div>
        </div>
    </div>

    <!-- Audio Element (Hidden) -->
    <audio id="audio-player"></audio>

    <script>
        // --- State Management ---
        const state = {
            currentTrack: null,
            isPlaying: false,
            audio: document.getElementById('audio-player'),
            theme: localStorage.getItem('theme') || 'system'
        };

        // --- DOM Elements ---
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const resultsGrid = document.getElementById('results-grid');
        const loader = document.getElementById('loader');
        const emptyState = document.getElementById('empty-state');
        const errorMsg = document.getElementById('error-msg');
        
        // Player Elements
        const playerBar = document.getElementById('player-bar');
        const mainPlayBtn = document.getElementById('main-play-btn');
        const playerImg = document.getElementById('player-img');
        const playerTitle = document.getElementById('player-title');
        const playerArtist = document.getElementById('player-artist');
        const progressBar = document.getElementById('progress-bar');
        const volumeSlider = document.getElementById('volume-slider');

        // --- Theme Logic ---
        function initTheme() {
            if (state.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }
        
        document.getElementById('theme-toggle').addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            if (document.documentElement.classList.contains('dark')) {
                localStorage.setItem('theme', 'dark');
            } else {
                localStorage.setItem('theme', 'light');
            }
        });
        
        initTheme();

        // --- Music Logic ---
        
        // 1. Fetch Data from iTunes
        async function searchMusic(query) {
            if (!query.trim()) return;

            // UI Updates
            resultsGrid.innerHTML = '';
            loader.classList.remove('hidden');
            emptyState.classList.add('hidden');
            errorMsg.classList.add('hidden');

            try {
                // Using iTunes Search API (JSONP handled via CORS proxy is often needed for strict apps, 
                // but iTunes usually allows direct fetch for simple GET).
                const response = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(query)}&media=music&entity=song&limit=24`);
                const data = await response.json();

                loader.classList.add('hidden');

                if (data.resultCount === 0) {
                    errorMsg.classList.remove('hidden');
                    return;
                }

                renderTracks(data.results);
            } catch (error) {
                console.error(error);
                loader.classList.add('hidden');
                errorMsg.classList.remove('hidden');
            }
        }

        // 2. Render Cards
        function renderTracks(tracks) {
            tracks.forEach(track => {
                // Get high-res image (iTunes gives 100x100 usually, replace to get 600x600)
                const highResImage = track.artworkUrl100.replace('100x100bb', '400x400bb');
                
                const card = document.createElement('div');
                card.className = "group relative bg-white/40 dark:bg-slate-800/40 backdrop-blur-md rounded-xl p-4 transition-all duration-300 hover:bg-white/60 dark:hover:bg-slate-700/60 hover:-translate-y-2 border border-white/20 shadow-lg cursor-pointer overflow-hidden";
                
                card.innerHTML = `
                    <div class="relative aspect-square rounded-lg overflow-hidden mb-3 shadow-md">
                        <img src="${highResImage}" alt="${track.trackName}" class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
                        <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                            <button class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center text-white shadow-lg transform scale-0 group-hover:scale-100 transition-transform duration-300">
                                <i class="fas fa-play pl-1"></i>
                            </button>
                        </div>
                    </div>
                    <h3 class="font-bold text-slate-800 dark:text-white truncate" title="${track.trackName}">${track.trackName}</h3>
                    <p class="text-sm text-gray-600 dark:text-slate-400 truncate">${track.artistName}</p>
                `;

                // Handle Click
                card.addEventListener('click', () => {
                    playTrack({
                        id: track.trackId,
                        title: track.trackName,
                        artist: track.artistName,
                        image: highResImage,
                        preview: track.previewUrl
                    });
                });

                resultsGrid.appendChild(card);
            });
        }

        // 3. Play Track
        function playTrack(track) {
            // Show player bar
            playerBar.classList.remove('translate-y-full');

            // If clicking the same song, toggle play/pause
            if (state.currentTrack && state.currentTrack.id === track.id) {
                togglePlay();
                return;
            }

            // New Song
            state.currentTrack = track;
            state.audio.src = track.preview;
            state.audio.volume = volumeSlider.value;
            
            // Update UI
            playerImg.src = track.image;
            playerTitle.textContent = track.title;
            playerArtist.textContent = track.artist;
            
            state.audio.play();
            updatePlayButton(true);
        }

        function togglePlay() {
            if (state.audio.paused) {
                state.audio.play();
                updatePlayButton(true);
            } else {
                state.audio.pause();
                updatePlayButton(false);
            }
        }

        function updatePlayButton(isPlaying) {
            state.isPlaying = isPlaying;
            mainPlayBtn.innerHTML = isPlaying 
                ? '<i class="fas fa-pause text-sm"></i>' 
                : '<i class="fas fa-play ml-0.5 text-sm"></i>';
            
            // Pulse animation on album art in player
            if(isPlaying) {
                playerImg.classList.add('animate-pulse');
            } else {
                playerImg.classList.remove('animate-pulse');
            }
        }

        // 4. Events & Progress
        state.audio.addEventListener('timeupdate', () => {
            const progress = (state.audio.currentTime / state.audio.duration) * 100;
            progressBar.style.width = `${progress}%`;
        });

        state.audio.addEventListener('ended', () => {
            updatePlayButton(false);
            progressBar.style.width = '0%';
        });

        // Search Events
        searchBtn.addEventListener('click', () => searchMusic(searchInput.value));
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchMusic(searchInput.value);
        });

        // Player Control Events
        mainPlayBtn.addEventListener('click', togglePlay);
        
        volumeSlider.addEventListener('input', (e) => {
            state.audio.volume = e.target.value;
        });

        // Initial Focus
        searchInput.focus();

    </script>
</body>
</html>
