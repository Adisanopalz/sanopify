<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanopify - Music for Everyone</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Tailwind Config for Custom Colors & Fonts -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        glass: {
                            light: 'rgba(255, 255, 255, 0.25)',
                            dark: 'rgba(15, 23, 42, 0.4)',
                            border: 'rgba(255, 255, 255, 0.1)',
                        },
                        accent: '#8b5cf6', // Violet
                    },
                    animation: {
                        'blob': 'blob 7s infinite',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #8b5cf6;
            border-radius: 10px;
        }
        
        /* Glassmorphism Utilities */
        .glass-panel {
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        /* Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 12px;
            width: 12px;
            border-radius: 50%;
            background: #fff;
            margin-top: -4px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
        }
        
        /* Hide scrollbar for genre list but keep functionality */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-slate-900 text-slate-800 dark:text-white transition-colors duration-300 min-h-screen flex flex-col overflow-x-hidden">

    <!-- Background Animated Blobs -->
    <div class="fixed inset-0 w-full h-full pointer-events-none z-0 overflow-hidden">
        <div class="absolute top-0 left-1/4 w-96 h-96 bg-purple-400 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob"></div>
        <div class="absolute top-0 right-1/4 w-96 h-96 bg-blue-400 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000"></div>
        <div class="absolute -bottom-32 left-1/3 w-96 h-96 bg-pink-400 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-4000"></div>
    </div>

    <!-- Navbar -->
    <nav class="fixed top-0 w-full z-50 px-6 py-4 glass-panel bg-white/30 dark:bg-slate-900/50 border-b border-white/10">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" onclick="window.location.reload()">
                <i class="fa-brands fa-spotify text-3xl text-purple-600 dark:text-purple-400"></i>
                <span class="text-2xl font-bold tracking-tight">Sanopify</span>
            </div>
            
            <button id="theme-toggle" class="p-2 rounded-full hover:bg-white/20 transition-colors">
                <i class="fas fa-moon text-xl dark:hidden"></i>
                <i class="fas fa-sun text-xl hidden dark:block text-yellow-300"></i>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="relative z-10 flex-grow pt-24 pb-32 px-4 sm:px-6">
        <div class="max-w-7xl mx-auto">
            
            <!-- Search & Filter Section -->
            <div class="flex flex-col items-center mb-8 gap-4">
                
                <h1 class="text-3xl md:text-5xl font-bold text-center mb-2 bg-clip-text text-transparent bg-gradient-to-r from-purple-600 to-blue-500 dark:from-purple-400 dark:to-blue-400">
                    Temukan Iramamu
                </h1>

                <!-- Search Bar -->
                <div class="w-full max-w-2xl relative group z-20">
                    <div class="absolute -inset-1 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full blur opacity-25 group-hover:opacity-50 transition duration-1000 group-hover:duration-200"></div>
                    <div class="relative flex items-center">
                        <input type="text" id="search-input" 
                            placeholder="Cari lagu, artis, atau album..." 
                            class="w-full py-3 pl-6 pr-28 rounded-full bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm border border-gray-200 dark:border-slate-700 focus:outline-none focus:ring-2 focus:ring-purple-500 shadow-xl text-lg placeholder-gray-400 dark:placeholder-slate-500 text-gray-800 dark:text-white transition-all"
                            autocomplete="off">
                        
                        <div class="absolute right-2 flex items-center gap-1">
                             <button id="filter-toggle-btn" class="p-2 text-gray-500 hover:text-purple-600 dark:text-slate-400 dark:hover:text-purple-400 transition" title="Filter Settings">
                                <i class="fas fa-sliders-h"></i>
                            </button>
                            <button id="search-btn" class="p-2.5 bg-purple-600 hover:bg-purple-700 text-white rounded-full transition-colors shadow-lg">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Advanced Filters (Hidden by default) -->
                <div id="filter-panel" class="hidden w-full max-w-2xl bg-white/50 dark:bg-slate-800/50 backdrop-blur-md rounded-xl p-4 border border-white/10 shadow-lg grid grid-cols-2 md:grid-cols-3 gap-4 transition-all animate-fade-in-down">
                    
                    <!-- Country Filter -->
                    <div class="flex flex-col gap-1">
                        <label class="text-xs font-semibold text-gray-600 dark:text-slate-300 uppercase">Negara</label>
                        <select id="country-select" class="w-full bg-white/80 dark:bg-slate-700 rounded-lg px-3 py-2 text-sm border border-transparent focus:border-purple-500 focus:outline-none">
                            <option value="ID" selected>üáÆüá© Indonesia</option>
                            <option value="US">üá∫üá∏ United States</option>
                            <option value="JP">üáØüáµ Japan</option>
                            <option value="KR">üá∞üá∑ South Korea</option>
                            <option value="GB">üá¨üáß United Kingdom</option>
                        </select>
                    </div>

                    <!-- Entity Filter -->
                    <div class="flex flex-col gap-1">
                        <label class="text-xs font-semibold text-gray-600 dark:text-slate-300 uppercase">Tipe</label>
                        <select id="entity-select" class="w-full bg-white/80 dark:bg-slate-700 rounded-lg px-3 py-2 text-sm border border-transparent focus:border-purple-500 focus:outline-none">
                            <option value="song" selected>üéµ Lagu</option>
                            <option value="album">üíø Album</option>
                            <option value="podcast">üéôÔ∏è Podcast</option>
                        </select>
                    </div>

                    <!-- Limit Filter -->
                    <div class="flex flex-col gap-1">
                        <label class="text-xs font-semibold text-gray-600 dark:text-slate-300 uppercase">Jumlah</label>
                        <select id="limit-select" class="w-full bg-white/80 dark:bg-slate-700 rounded-lg px-3 py-2 text-sm border border-transparent focus:border-purple-500 focus:outline-none">
                            <option value="25" selected>25 Hasil</option>
                            <option value="50">50 Hasil</option>
                            <option value="100">100 Hasil</option>
                        </select>
                    </div>
                </div>

                <!-- Quick Genres Pills -->
                <div class="w-full max-w-4xl overflow-x-auto no-scrollbar flex items-center justify-start md:justify-center gap-2 pb-2 px-2">
                    <button class="genre-pill whitespace-nowrap px-4 py-1.5 rounded-full bg-white/50 dark:bg-slate-800/50 hover:bg-purple-600 hover:text-white dark:hover:bg-purple-600 transition text-sm border border-white/10" data-genre="Indonesian Pop">Indo Pop</button>
                    <button class="genre-pill whitespace-nowrap px-4 py-1.5 rounded-full bg-white/50 dark:bg-slate-800/50 hover:bg-purple-600 hover:text-white dark:hover:bg-purple-600 transition text-sm border border-white/10" data-genre="K-Pop">K-Pop</button>
                    <button class="genre-pill whitespace-nowrap px-4 py-1.5 rounded-full bg-white/50 dark:bg-slate-800/50 hover:bg-purple-600 hover:text-white dark:hover:bg-purple-600 transition text-sm border border-white/10" data-genre="Dangdut">Dangdut</button>
                    <button class="genre-pill whitespace-nowrap px-4 py-1.5 rounded-full bg-white/50 dark:bg-slate-800/50 hover:bg-purple-600 hover:text-white dark:hover:bg-purple-600 transition text-sm border border-white/10" data-genre="J-Pop">J-Pop</button>
                    <button class="genre-pill whitespace-nowrap px-4 py-1.5 rounded-full bg-white/50 dark:bg-slate-800/50 hover:bg-purple-600 hover:text-white dark:hover:bg-purple-600 transition text-sm border border-white/10" data-genre="Rock">Rock</button>
                    <button class="genre-pill whitespace-nowrap px-4 py-1.5 rounded-full bg-white/50 dark:bg-slate-800/50 hover:bg-purple-600 hover:text-white dark:hover:bg-purple-600 transition text-sm border border-white/10" data-genre="Jazz">Jazz</button>
                    <button class="genre-pill whitespace-nowrap px-4 py-1.5 rounded-full bg-white/50 dark:bg-slate-800/50 hover:bg-purple-600 hover:text-white dark:hover:bg-purple-600 transition text-sm border border-white/10" data-genre="Lo-Fi">Lo-Fi</button>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loader" class="hidden flex justify-center py-12">
                <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"></div>
            </div>

            <!-- Error State -->
            <div id="error-msg" class="hidden text-center py-8 text-red-500 font-semibold bg-red-100/10 rounded-lg border border-red-500/20">
                <i class="fas fa-exclamation-circle mb-2 block text-2xl"></i>
                <span id="error-text">Terjadi kesalahan.</span>
            </div>

            <!-- Results Grid -->
            <div id="results-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                <!-- Cards injected via JS -->
            </div>
            
            <!-- Empty State -->
            <div id="empty-state" class="text-center py-16 opacity-60">
                <i class="fas fa-headphones-simple text-6xl mb-4 text-gray-300 dark:text-slate-700 animate-bounce"></i>
                <p class="text-xl">Cari musik favoritmu atau pilih genre di atas.</p>
            </div>
        </div>
    </main>

    <!-- Player Bar (Fixed Bottom) -->
    <div id="player-bar" class="fixed bottom-0 w-full z-50 glass-panel bg-white/80 dark:bg-slate-900/90 border-t border-white/10 backdrop-blur-xl transform translate-y-full transition-transform duration-500">
        
        <!-- Progress Bar -->
        <div class="w-full h-1 bg-gray-200 dark:bg-slate-700 cursor-pointer group relative" id="progress-container">
            <div id="progress-bar" class="h-full bg-purple-600 relative w-0 transition-all duration-100 ease-linear">
                <div class="absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full shadow opacity-0 group-hover:opacity-100 transition-opacity"></div>
            </div>
            <!-- Time Tooltip -->
             <div class="absolute top-[-25px] right-2 text-xs font-mono text-gray-500 dark:text-gray-400">
                <span id="current-time">0:00</span> / <span id="duration">0:30</span>
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between gap-4">
            
            <!-- Song Info -->
            <div class="flex items-center gap-4 w-1/3 min-w-[120px]">
                <img id="player-img" src="https://via.placeholder.com/100" alt="Album Art" class="w-12 h-12 rounded-md shadow-md object-cover bg-slate-800">
                <div class="overflow-hidden">
                    <h3 id="player-title" class="text-sm font-bold truncate text-slate-800 dark:text-white">Pilih Lagu</h3>
                    <p id="player-artist" class="text-xs text-gray-500 dark:text-slate-400 truncate">Sanopify</p>
                </div>
            </div>

            <!-- Controls -->
            <div class="flex flex-col items-center justify-center w-1/3">
                <div class="flex items-center gap-4 sm:gap-6">
                    <!-- Shuffle Button -->
                    <button id="shuffle-btn" class="text-gray-400 hover:text-purple-600 transition" title="Shuffle">
                        <i class="fas fa-shuffle"></i>
                    </button>

                    <!-- Prev -->
                    <button id="prev-btn" class="text-gray-600 dark:text-gray-300 hover:text-purple-600 dark:hover:text-white transition">
                        <i class="fas fa-backward-step text-lg"></i>
                    </button>
                    
                    <!-- Play/Pause -->
                    <button id="main-play-btn" class="w-10 h-10 flex items-center justify-center rounded-full bg-white text-black shadow-lg hover:scale-105 transition transform">
                        <i class="fas fa-play ml-0.5 text-sm"></i>
                    </button>
                    
                    <!-- Next -->
                    <button id="next-btn" class="text-gray-600 dark:text-gray-300 hover:text-purple-600 dark:hover:text-white transition">
                        <i class="fas fa-forward-step text-lg"></i>
                    </button>

                    <!-- Repeat (Visual only for this demo) -->
                    <button class="text-gray-400 hover:text-purple-600 transition hidden sm:block">
                        <i class="fas fa-repeat"></i>
                    </button>
                </div>
            </div>

            <!-- Volume -->
            <div class="flex items-center justify-end gap-3 w-1/3 min-w-[100px]">
                <i class="fas fa-volume-up text-xs text-gray-500"></i>
                <input type="range" min="0" max="1" step="0.1" value="1" id="volume-slider" class="w-20 md:w-24 accent-purple-600">
            </div>
        </div>
    </div>

    <!-- Audio Element (Hidden) -->
    <audio id="audio-player"></audio>

    <script>
        // --- State Management ---
        const state = {
            playlist: [],      // Array of track objects
            currentIndex: -1,  // Index in playlist
            isPlaying: false,
            isShuffle: false,
            audio: document.getElementById('audio-player'),
            theme: localStorage.getItem('theme') || 'system'
        };

        // --- DOM Elements ---
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const filterToggleBtn = document.getElementById('filter-toggle-btn');
        const filterPanel = document.getElementById('filter-panel');
        
        // Filters
        const countrySelect = document.getElementById('country-select');
        const entitySelect = document.getElementById('entity-select');
        const limitSelect = document.getElementById('limit-select');
        const genrePills = document.querySelectorAll('.genre-pill');

        const resultsGrid = document.getElementById('results-grid');
        const loader = document.getElementById('loader');
        const emptyState = document.getElementById('empty-state');
        const errorMsg = document.getElementById('error-msg');
        const errorText = document.getElementById('error-text');
        
        // Player Elements
        const playerBar = document.getElementById('player-bar');
        const mainPlayBtn = document.getElementById('main-play-btn');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const shuffleBtn = document.getElementById('shuffle-btn');
        
        const playerImg = document.getElementById('player-img');
        const playerTitle = document.getElementById('player-title');
        const playerArtist = document.getElementById('player-artist');
        const progressBar = document.getElementById('progress-bar');
        const progressContainer = document.getElementById('progress-container');
        const currentTimeEl = document.getElementById('current-time');
        const durationEl = document.getElementById('duration');
        const volumeSlider = document.getElementById('volume-slider');

        // --- Theme Logic ---
        function initTheme() {
            if (state.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }
        
        document.getElementById('theme-toggle').addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            state.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            localStorage.setItem('theme', state.theme);
        });
        
        initTheme();

        // --- Filter Toggle Logic ---
        filterToggleBtn.addEventListener('click', () => {
            filterPanel.classList.toggle('hidden');
        });

        // --- Music Logic ---
        
        // 1. Fetch Data
        async function searchMusic(query) {
            if (!query.trim()) return;

            // UI Reset
            resultsGrid.innerHTML = '';
            loader.classList.remove('hidden');
            emptyState.classList.add('hidden');
            errorMsg.classList.add('hidden');
            
            // Get Filters
            const country = countrySelect.value;
            const entity = entitySelect.value;
            const limit = limitSelect.value;

            try {
                // Construct URL with filters
                const url = `https://itunes.apple.com/search?term=${encodeURIComponent(query)}&country=${country}&media=music&entity=${entity}&limit=${limit}`;
                
                const response = await fetch(url);
                const data = await response.json();

                loader.classList.add('hidden');

                if (data.resultCount === 0) {
                    errorText.textContent = "Tidak ada hasil ditemukan.";
                    errorMsg.classList.remove('hidden');
                    return;
                }

                // Process tracks to add Year and standardize
                const processedTracks = data.results.map(item => ({
                    id: item.trackId || item.collectionId,
                    title: item.trackName || item.collectionName,
                    artist: item.artistName,
                    image: (item.artworkUrl100 || '').replace('100x100bb', '400x400bb'),
                    preview: item.previewUrl,
                    year: item.releaseDate ? new Date(item.releaseDate).getFullYear() : '',
                    album: item.collectionName
                })).filter(t => t.preview); // Only keep items with previews

                if (processedTracks.length === 0) {
                    errorText.textContent = "Tidak ada preview yang tersedia untuk pencarian ini.";
                    errorMsg.classList.remove('hidden');
                    return;
                }

                state.playlist = processedTracks; // Save to playlist state
                renderTracks(processedTracks);
            } catch (error) {
                console.error(error);
                loader.classList.add('hidden');
                errorText.textContent = "Gagal memuat data. Cek koneksi internet Anda.";
                errorMsg.classList.remove('hidden');
            }
        }

        // 2. Render Cards
        function renderTracks(tracks) {
            tracks.forEach((track, index) => {
                const card = document.createElement('div');
                card.className = "group relative bg-white/40 dark:bg-slate-800/40 backdrop-blur-md rounded-xl p-4 transition-all duration-300 hover:bg-white/60 dark:hover:bg-slate-700/60 hover:-translate-y-2 border border-white/20 shadow-lg cursor-pointer overflow-hidden";
                
                card.innerHTML = `
                    <div class="relative aspect-square rounded-lg overflow-hidden mb-3 shadow-md bg-slate-200 dark:bg-slate-700">
                        <img src="${track.image}" alt="${track.title}" class="w-full h-full object-cover transition duration-500 group-hover:scale-110" onerror="this.src='https://via.placeholder.com/400?text=No+Image'">
                        <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                            <button class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center text-white shadow-lg transform scale-0 group-hover:scale-100 transition-transform duration-300">
                                <i class="fas fa-play pl-1"></i>
                            </button>
                        </div>
                        <div class="absolute top-2 right-2 bg-black/60 text-white text-[10px] px-2 py-0.5 rounded-full backdrop-blur-sm">
                            ${track.year}
                        </div>
                    </div>
                    <h3 class="font-bold text-slate-800 dark:text-white truncate text-base mb-0.5" title="${track.title}">${track.title}</h3>
                    <p class="text-sm text-gray-600 dark:text-slate-400 truncate hover:underline">${track.artist}</p>
                    <p class="text-xs text-gray-400 dark:text-slate-500 truncate mt-1">${track.album || ''}</p>
                `;

                // Handle Click
                card.addEventListener('click', () => {
                    playTrack(index);
                });

                resultsGrid.appendChild(card);
            });
        }

        // 3. Play Logic
        function playTrack(index) {
            if (index < 0 || index >= state.playlist.length) return;

            state.currentIndex = index;
            const track = state.playlist[index];

            // Show player bar
            playerBar.classList.remove('translate-y-full');

            state.audio.src = track.preview;
            state.audio.volume = volumeSlider.value;
            
            // Update UI
            playerImg.src = track.image;
            playerTitle.textContent = track.title;
            playerArtist.textContent = track.artist;
            
            state.audio.play().catch(e => console.log("Auto-play prevented"));
            updatePlayButton(true);

            // Update Active State in Grid (Optional Visual)
            // Could add a class to the active card here
        }

        function togglePlay() {
            if (state.playlist.length === 0) return;
            
            if (state.audio.paused) {
                state.audio.play();
                updatePlayButton(true);
            } else {
                state.audio.pause();
                updatePlayButton(false);
            }
        }

        function updatePlayButton(isPlaying) {
            state.isPlaying = isPlaying;
            mainPlayBtn.innerHTML = isPlaying 
                ? '<i class="fas fa-pause text-sm"></i>' 
                : '<i class="fas fa-play ml-0.5 text-sm"></i>';
            
            if(isPlaying) {
                playerImg.classList.add('animate-pulse');
            } else {
                playerImg.classList.remove('animate-pulse');
            }
        }

        function playNext() {
            if (state.playlist.length === 0) return;

            let nextIndex;
            if (state.isShuffle) {
                // Random index distinct from current
                do {
                    nextIndex = Math.floor(Math.random() * state.playlist.length);
                } while (nextIndex === state.currentIndex && state.playlist.length > 1);
            } else {
                nextIndex = (state.currentIndex + 1) % state.playlist.length;
            }
            playTrack(nextIndex);
        }

        function playPrev() {
            if (state.playlist.length === 0) return;
            
            // If playing more than 3 sec, restart song
            if (state.audio.currentTime > 3) {
                state.audio.currentTime = 0;
                return;
            }

            let prevIndex = (state.currentIndex - 1 + state.playlist.length) % state.playlist.length;
            playTrack(prevIndex);
        }

        function toggleShuffle() {
            state.isShuffle = !state.isShuffle;
            shuffleBtn.classList.toggle('text-purple-600');
            shuffleBtn.classList.toggle('text-gray-400');
            
            // Optional: Visual feedback
            if(state.isShuffle) {
                shuffleBtn.classList.add('scale-110');
            } else {
                shuffleBtn.classList.remove('scale-110');
            }
        }

        // 4. Events
        state.audio.addEventListener('timeupdate', () => {
            if(state.audio.duration) {
                const progress = (state.audio.currentTime / state.audio.duration) * 100;
                progressBar.style.width = `${progress}%`;
                
                // Update Time Text
                const curMins = Math.floor(state.audio.currentTime / 60);
                const curSecs = Math.floor(state.audio.currentTime % 60);
                currentTimeEl.textContent = `${curMins}:${curSecs < 10 ? '0' : ''}${curSecs}`;
            }
        });

        state.audio.addEventListener('ended', playNext);

        // Click on Progress Bar to Seek
        progressContainer.addEventListener('click', (e) => {
            const width = progressContainer.clientWidth;
            const clickX = e.offsetX;
            const duration = state.audio.duration;
            state.audio.currentTime = (clickX / width) * duration;
        });

        // Search Interactions
        searchBtn.addEventListener('click', () => searchMusic(searchInput.value));
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchMusic(searchInput.value);
        });

        // Genre Pills Interaction
        genrePills.forEach(pill => {
            pill.addEventListener('click', () => {
                const genre = pill.getAttribute('data-genre');
                searchInput.value = genre;
                searchMusic(genre);
            });
        });

        // Filter Changes triggers search if input exists
        [countrySelect, entitySelect, limitSelect].forEach(select => {
            select.addEventListener('change', () => {
                if(searchInput.value.trim()) {
                    searchMusic(searchInput.value);
                }
            });
        });

        // Player Controls
        mainPlayBtn.addEventListener('click', togglePlay);
        nextBtn.addEventListener('click', playNext);
        prevBtn.addEventListener('click', playPrev);
        shuffleBtn.addEventListener('click', toggleShuffle);
        
        volumeSlider.addEventListener('input', (e) => {
            state.audio.volume = e.target.value;
        });

        // Initial Focus
        searchInput.focus();

    </script>
</body>
</html>
